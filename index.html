<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°–ø—Ä—è—á—å –ö–æ–ª–æ–±–∫–∞</title>
    <style>
        :root {
            --game-width: 100%;
            --game-height: 56.25vw; /* –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 16:9 */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            background-color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            touch-action: none;
        }

        /* –ò–ì–†–û–í–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† */
        #game-container {
            position: relative;
            width: var(--game-width);
            max-width: 1000px;
            aspect-ratio: 16/9;
            background-color: #4CAF50; /* –ó–∞–ø–∞—Å–Ω–æ–π —Ü–≤–µ—Ç */
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border-radius: 10px;
        }

        /* 1. –§–û–ù (fon1.png) */
        .background-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('fon1.png'); /* –í–ê–® –§–û–ù */
            background-size: cover;
            background-position: center;
            z-index: 1;
        }

        /* –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ –° –ú–ò–ù–ò-–ö–ê–†–¢–û–ô */
        .ui-layer {
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            z-index: 10;
            display: flex;
            justify-content: flex-end; /* –ü—Ä–∏–∂–∏–º–∞–µ–º –≤–ø—Ä–∞–≤–æ */
            pointer-events: none;
        }

        /* 2. –ú–ò–ù–ò-–ö–ê–†–¢–ê (map.png) */
        .mini-map-container {
            position: relative;
            width: 150px; /* –†–∞–∑–º–µ—Ä –º–∏–Ω–∏-–∫–∞—Ä—Ç—ã */
            height: 84px;  /* –ü—Ä–æ–ø–æ—Ä—Ü–∏—è 16:9 */
            border: 3px solid white;
            border-radius: 8px;
            pointer-events: auto;
            background: #000;
            overflow: hidden;
        }

        .mini-map-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* –ó–µ–ª–µ–Ω—ã–π –º–∞—Ä–∫–µ—Ä –Ω–∞ –º–∏–Ω–∏-–∫–∞—Ä—Ç–µ (—É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–∏–∂–Ω–∏–π –ª–µ–≤—ã–π —É–≥–æ–ª) */
        .safe-marker {
            position: absolute;
            bottom: 5px;
            left: 5px;
            width: 20px;
            height: 20px;
            background-color: rgba(0, 255, 0, 0.6);
            border: 2px solid #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px #0f0;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 0.4; }
            100% { transform: scale(1); opacity: 0.8; }
        }

        /* –ò–ì–†–û–í–û–ï –ü–û–õ–ï (–ó–æ–Ω—ã) */
        .game-field {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
        }

        /* –ù–µ–≤–∏–¥–∏–º—ã–µ –∑–æ–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ø–∞–¥–∞–Ω–∏—è */
        .drop-zone {
            position: absolute;
            width: 25%;
            height: 25%;
            /* border: 2px dashed red;  –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –∑–æ–Ω—ã –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ */
            z-index: 6;
        }

        /* –ó–æ–Ω–∞ –ù–ò–ñ–ù–ò–ô –õ–ï–í–´–ô –£–ì–û–õ (–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è) */
        #zone-bl {
            bottom: 10%;
            left: 10%;
        }

        /* 3. –ö–û–õ–û–ë–û–ö (Kolobok.png) */
        #kolobok {
            position: absolute;
            width: 120px; /* –†–∞–∑–º–µ—Ä –∫–æ–ª–æ–±–∫–∞ */
            height: auto;
            right: 20px;       /* –°–ø—Ä–∞–≤–∞ */
            top: 50%;          /* –ü–æ —Ü–µ–Ω—Ç—Ä—É –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
            transform: translateY(-50%);
            z-index: 20;
            cursor: grab;
            touch-action: none;
            user-select: none;
            transition: transform 0.1s;
        }

        #kolobok:active {
            cursor: grabbing;
            transform: translateY(-50%) scale(1.1);
        }
        
        /* –ö–ª–∞—Å—Å –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –º–µ—Å—Ç–æ */
        #kolobok.returning {
            transition: all 0.5s ease-out;
        }

        /* –≠–ö–†–ê–ù –ü–û–ë–ï–î–´ */
        #win-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 100;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }

        #win-screen h2 {
            font-size: 40px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px gold;
        }

        button {
            padding: 15px 30px;
            font-size: 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #2E7D32;
        }
        button:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }
        .shake {
            animation: shake 0.4s;
        }

    </style>
</head>
<body>

<div id="game-container">
    <!-- 1. –§–û–ù -->
    <div class="background-layer"></div>

    <!-- –í–ï–†–•: –ú–ò–ù–ò-–ö–ê–†–¢–ê -->
    <div class="ui-layer">
        <div class="mini-map-container">
            <!-- 2. –ö–ê–†–¢–ò–ù–ö–ê –ö–ê–†–¢–´ -->
            <img src="map.png" alt="Mini Map" class="mini-map-img">
            <!-- –ú–∞—Ä–∫–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (–ù–∏–∂–Ω–∏–π –ª–µ–≤—ã–π —É–≥–æ–ª –∫–∞—Ä—Ç—ã) -->
            <div class="safe-marker"></div>
        </div>
    </div>

    <!-- –ó–û–ù–´ (–ù–µ–≤–∏–¥–∏–º—ã–µ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏) -->
    <div class="game-field">
        <!-- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–æ–Ω–∞: –ù–∏–∂–Ω–∏–π –ª–µ–≤—ã–π —É–≥–æ–ª -->
        <div class="drop-zone" id="zone-bl"></div>
        
        <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–æ–Ω—ã (–¥–ª—è –æ—Ç–ª–æ–≤–∞ –æ—à–∏–±–æ–∫) -->
        <div class="drop-zone" id="zone-tl" style="top:10%; left:10%"></div>
        <div class="drop-zone" id="zone-tr" style="top:10%; right:10%"></div>
        <div class="drop-zone" id="zone-br" style="bottom:10%; right:10%"></div>
    </div>

    <!-- 3. –ö–û–õ–û–ë–û–ö -->
    <img src="Kolobok.png" id="kolobok" alt="–ö–æ–ª–æ–±–æ–∫">

    <!-- –ü–û–ë–ï–î–ê -->
    <div id="win-screen">
        <h2>–ú–û–õ–û–î–ï–¶!<br>–ö–û–õ–û–ë–û–ö –°–ü–†–Ø–¢–ê–õ–°–Ø! üéâ</h2>
        <button onclick="startGame()">–ò–ì–†–ê–¢–¨ –ï–©–Å</button>
    </div>
</div>

<script>
    const kolobok = document.getElementById('kolobok');
    const winScreen = document.getElementById('win-screen');
    const container = document.getElementById('game-container');
    
    // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–æ–Ω–∞ –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–∞: –ù–∏–∂–Ω–∏–π –õ–µ–≤—ã–π (Bottom-Left)
    const SAFE_ZONE_ID = 'zone-bl'; 

    let isDragging = false;
    let startX, startY;

    // –ó–≤—É–∫–∏ (–ø—Ä–æ—Å—Ç–æ–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        if (type === 'win') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.2);
        }
    }

    function startGame() {
        winScreen.style.display = 'none';
        kolobok.classList.remove('returning');
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ö–æ–ª–æ–±–∫–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç (—Å–ø—Ä–∞–≤–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É)
        kolobok.style.right = '20px';
        kolobok.style.left = 'auto';
        kolobok.style.top = '50%';
        kolobok.style.transform = 'translateY(-50%)';
    }

    // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï (DRAG & DROP) ---

    function onDragStart(e) {
        if (winScreen.style.display === 'flex') return;
        
        isDragging = true;
        kolobok.classList.remove('returning');

        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;

        // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Å–º–µ—â–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∫–æ–ª–æ–±–æ–∫ –Ω–µ "–ø—Ä—ã–≥–∞–ª" –∫ –∫—É—Ä—Å–æ—Ä—É —Ü–µ–Ω—Ç—Ä–æ–º
        const rect = kolobok.getBoundingClientRect();
        startX = clientX - rect.left;
        startY = clientY - rect.top;
        
        // –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è
        kolobok.style.transform = 'none';
        kolobok.style.right = 'auto';
        kolobok.style.top = (clientY - startY) + 'px';
        kolobok.style.left = (clientX - startX) + 'px';
    }

    function onDragMove(e) {
        if (!isDragging) return;
        e.preventDefault();

        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;

        kolobok.style.left = (clientX - startX) + 'px';
        kolobok.style.top = (clientY - startY) + 'px';
    }

    function onDragEnd(e) {
        if (!isDragging) return;
        isDragging = false;
        checkDrop();
    }

    function checkDrop() {
        const kolobokRect = kolobok.getBoundingClientRect();
        // –ë–µ—Ä–µ–º —Ü–µ–Ω—Ç—Ä –∫–æ–ª–æ–±–∫–∞
        const kCenterX = kolobokRect.left + kolobokRect.width / 2;
        const kCenterY = kolobokRect.top + kolobokRect.height / 2;

        const safeZoneEl = document.getElementById(SAFE_ZONE_ID);
        const zoneRect = safeZoneEl.getBoundingClientRect();

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ø–∞–ª –ª–∏ —Ü–µ–Ω—Ç—Ä –∫–æ–ª–æ–±–∫–∞ –≤ –∑–æ–Ω—É –Ω–∏–∂–Ω–µ–≥–æ –ª–µ–≤–æ–≥–æ —É–≥–ª–∞
        if (kCenterX >= zoneRect.left && kCenterX <= zoneRect.right &&
            kCenterY >= zoneRect.top && kCenterY <= zoneRect.bottom) {
            
            handleWin();
        } else {
            handleLoss();
        }
    }

    function handleWin() {
        playSound('win');
        
        // –ü—Ä–∏–ª–µ–ø–ª—è–µ–º –∫–æ–ª–æ–±–∫–∞ —Ç–æ—á–Ω–æ –≤ —Ü–µ–Ω—Ç—Ä –∑–æ–Ω—ã
        const zoneRect = document.getElementById(SAFE_ZONE_ID).getBoundingClientRect();
        const containerRect = container.getBoundingClientRect();
        
        kolobok.style.left = (zoneRect.left - containerRect.left + zoneRect.width/2 - kolobok.offsetWidth/2) + 'px';
        kolobok.style.top = (zoneRect.top - containerRect.top + zoneRect.height/2 - kolobok.offsetHeight/2) + 'px';

        setTimeout(() => {
            winScreen.style.display = 'flex';
        }, 500);
    }

    function handleLoss() {
        playSound('loss');
        // –¢—Ä—è—Å–µ–º —ç–∫—Ä–∞–Ω
        container.classList.add('shake');
        setTimeout(() => container.classList.remove('shake'), 400);
        returnToStart();
    }

    function returnToStart() {
        kolobok.classList.add('returning');
        kolobok.style.right = '20px';
        kolobok.style.left = 'auto';
        kolobok.style.top = '50%';
        kolobok.style.transform = 'translateY(-50%)';
    }

    // –°–æ–±—ã—Ç–∏—è
    kolobok.addEventListener('mousedown', onDragStart);
    window.addEventListener('mousemove', onDragMove);
    window.addEventListener('mouseup', onDragEnd);

    kolobok.addEventListener('touchstart', onDragStart, {passive: false});
    window.addEventListener('touchmove', onDragMove, {passive: false});
    window.addEventListener('touchend', onDragEnd);

    // –°—Ç–∞—Ä—Ç
    startGame();

</script>
</body>
</html>
